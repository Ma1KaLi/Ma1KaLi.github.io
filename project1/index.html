<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Project 1 — Prokudin–Gorskii Alignment</title>
  <style>
    :root { --maxw: 980px; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0; line-height: 1.6; color: #222; background: #fafafa;
    }
    header, main, footer { max-width: var(--maxw); margin: 0 auto; padding: 20px; }
    header h1 { margin: 0 0 6px; }
    header a { color: #0b5fff; text-decoration: none; }
    .back { display: inline-block; margin-top: 6px; }
    section {
      background: #fff; border: 1px solid #eee; border-radius: 14px;
      padding: 18px; margin: 18px 0 24px; box-shadow: 0 1px 3px rgba(0,0,0,.05);
    }
    h2 { margin: 0 0 12px; font-size: 1.25rem; }
    p { margin: 8px 0; }
    .grid-2 { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; }
    @media (max-width: 720px) { .grid-2 { grid-template-columns: 1fr; } }

    /* Figures (if you add any) */
    figure { margin: 0; border: 1px solid #eee; border-radius: 12px; overflow: hidden; background: #fff; }
    figure img, figure video { display: block; width: 100%; height: auto; }
    figcaption { font-size: .9rem; padding: 10px 12px; background: #f6f7fb; border-top: 1px solid #eee; }

    /* Callouts */
    .answer { background: #f4fbf6; border: 1px solid #d8f1df; border-radius: 10px; padding: 10px 12px; margin-top: 10px; }
    .note { font-size: .92rem; color: #555; background: #fff7e6; border: 1px solid #ffe2a8; border-radius: 10px; padding: 10px 12px; margin-top: 10px; }

    /* Tables */
    table { width: 100%; border-collapse: collapse; }
    thead th {
      text-align: left; font-weight: 600; padding: 10px 10px; background: #f6f7fb; border-bottom: 1px solid #eee;
    }
    tbody td { padding: 10px; border-top: 1px solid #eee; vertical-align: middle; }
    td img { width: 240px; height: auto; display: block; border-radius: 10px; border: 1px solid #eee; }
    td.number { white-space: nowrap; font-variant-numeric: tabular-nums; }
    td.time { font-variant-numeric: tabular-nums; }
    @media (max-width: 720px) {
      td img { width: 100%; }
    }

    footer { font-size: .9rem; color: #666; }
  </style>
</head>
<body>
  <header>
    <h1>Project 1: Prokudin–Gorskii Colorizing & Alignment</h1>
    <a class="back" href="../index.html">← Back to main portfolio</a>
  </header>

  <main>
    <!-- Intro -->
    <section id="intro">
      <h2>Overview</h2>
      <p>
        Sergey Prokudin–Gorskii photographed scenes using three sequential exposures through blue, green, and red filters.
        The Library of Congress scans are tall grayscale plates that stack these exposures vertically (top→bottom = B/G/R).
        This project reconstructs color images by splitting the plate into three channels, aligning <strong>G→B</strong> and
        <strong>R→B</strong> using a pure translation model, and stacking into RGB.
      </p>
      <div class="answer">
        <strong>Pipeline highlights</strong><br>
        Float processing (0–1), valid-overlap scoring (no wrap-around), small interior crop to suppress borders, SSD/NCC metrics,
        and a coarse-to-fine pyramid to handle large displacements efficiently.
      </div>
    </section>

    <!-- Single-scale -->
    <section id="single">
      <h2>Single-scale Alignment</h2>
      <p>
        For smaller plates, I use a brute-force search over integer displacements within a fixed window (e.g., ±15 px).
        The score is computed only on the overlapping interior to avoid border bias. NCC generally outperforms SSD on cross-channel matches.
      </p>
      <ol>
        <li><strong>Split:</strong> crop to a multiple of 3 rows, then slice B/G/R thirds.</li>
        <li><strong>Search:</strong> for each (dy, dx) in the window, compute valid overlap (no wrap), then crop ~5% from each side.</li>
        <li><strong>Score:</strong> SSD or NCC on the interior; pick the best (min SSD / max NCC).</li>
        <li><strong>Apply:</strong> shift G and R by the winning displacements, then stack <code>[R, G, B]</code>.</li>
      </ol>

      <!-- 3 × 4 table -->
      <table>
        <thead>
          <tr>
            <th>Image</th>
            <th>Green Channel Displacement</th>
            <th>Red Channel Displacement</th>
            <th>Processing Time (s)</th>
          </tr>
        </thead>
        <tbody>
          <!-- Replace with your single-scale results -->
          <tr>
            <td><img src="Media/out_monastery.jpg" alt="out_monastery.jpg" loading="lazy"></td>
            <td class="number">(−3, 2)</td>
            <td class="number">(3, 2)</td>
            <td class="time">1.62</td>
          </tr>
          <tr>
            <td><img src="Media/out_cathedral.jpg" alt="out_cathedral.jpg" loading="lazy"></td>
            <td class="number">(5, 2)</td>
            <td class="number">(12, 3)</td>
            <td class="time">1.86</td>
          </tr>
          <tr>
            <td><img src="Media/out_tobolsk.jpg" alt="out_tobolsk.jpg" loading="lazy"></td>
            <td class="number">(3, 3)</td>
            <td class="number">(6, 3)</td>
            <td class="time">1.78</td>
          </tr>
        </tbody>
      </table>

      <div class="note">
        Displacements are reported as <code>(dy, dx)</code> with the moving channel aligned to Blue (G→B and R→B).
      </div>
    </section>

    <!-- Pyramid -->
    <section id="pyramid">
      <h2>Pyramid-Speedup Alignment</h2>
      <p>
        For high-resolution plates, exhaustive search is too slow. I build a pyramid by 2×2 averaging (anti-alias) and downsample by 2
        until the shortest side ≤ 100 px. Alignment proceeds coarse→fine: search a window (±10) at the coarsest level, scale the displacement
        by 2 when moving up a level, and refine within ±10 around the upsampled center. Scores are NCC on cropped interiors (~5%).
      </p>
      <ol>
        <li><strong>Downsample:</strong> 2×2 mean (low-pass) then decimate by 2 — repeat until small.</li>
        <li><strong>Coarse search:</strong> find a good shift at the smallest scale.</li>
        <li><strong>Propagate & refine:</strong> double the shift per level and locally refine (±10).</li>
        <li><strong>Finalize:</strong> apply the full-resolution shift to the un-cropped channel and compose RGB.</li>
      </ol>

      <!-- 11 × 4 table -->
      <table>
        <thead>
          <tr>
            <th>Image</th>
            <th>Green Channel Displacement</th>
            <th>Red Channel Displacement</th>
            <th>Processing Time (s)</th>
          </tr>
        </thead>
        <tbody>
          <!-- Replace TBD rows with your pyramid results (11 rows total) -->
          <tr><td><img src="Media/out_church_pyr_simple.jpg" alt="Church — pyramid" loading="lazy"></td><td class="number">(25, 4)</td><td class="number">(58, -4)</td><td class="time">13.98</td></tr>
          <tr><td><img src="Media/out_emir_pyr_simple.jpg" alt="Emir — pyramid" loading="lazy"></td><td class="number">(49, 24)</td><td class="number">(292, -578)</td><td class="time">12.19</td></tr>
          <tr><td><img src="Media/out_harvesters_pyr_simple.jpg" alt="Monastery — pyramid" loading="lazy"></td><td class="number">(60, 17)</td><td class="number">(124, 14)</td><td class="time">13.68</td></tr>
          <tr><td><img src="Media/out_icon_pyr_simple.jpg" alt="Icon — pyramid" loading="lazy"></td><td class="number">(41, 17)</td><td class="number">(89, 23)</td><td class="time">14.65</td></tr>
          <tr><td><img src="Media/out_italil_pyr_simple.jpg" alt="Italil — pyramid" loading="lazy"></td><td class="number">(38, 21)</td><td class="number">(77, 35)</td><td class="time">15.02</td></tr>
          <tr><td><img src="Media/out_lastochikino_pyr_simple.jpg" alt="Lastochikino — pyramid" loading="lazy"></td><td class="number">(-3, -2)</td><td class="number">(75, -9)</td><td class="time">14.38</td></tr>
          <tr><td><img src="Media/out_lugano_pyr_simple.jpg" alt="Lugano — pyramid" loading="lazy"></td><td class="number">(41, -16)</td><td class="number">(93, -29)</td><td class="time">14.89</td></tr>
          <tr><td><img src="Media/out_melons_pyr_simple.jpg" alt="Melons — pyramid" loading="lazy"></td><td class="number">(82, 11)</td><td class="number">(179, 13)</td><td class="time">14.44</td></tr>
          <tr><td><img src="Media/out_self_portrait_pyr_simple.jpg" alt="Self_Portrait — pyramid" loading="lazy"></td><td class="number">(79, 29)</td><td class="number">(176, 37)</td><td class="time">14.12</td></tr>
          <tr><td><img src="Media/out_siren_pyr_simple.jpg" alt="Siren — pyramid" loading="lazy"></td><td class="number">(49, -6)</td><td class="number">(96, -25)</td><td class="time">14.96</td></tr>
          <tr><td><img src="Media/out_three_generations_pyr_simple.jpg" alt="Three_Generations — pyramid" loading="lazy"></td><td class="number">(53, 14)</td><td class="number">(112, 11)</td><td class="time">14.18</td></tr>
        </tbody>
      </table>

      <div class="note">
        Using fixed parameters across images keeps the results comparable. If an image has strong black borders, a slightly larger interior crop can help.
      </div>
    </section>

    

    <!-- Bonus -->
    <section id="bonus">
      <h2>Bonus Images</h2>
      <p>Additional plates aligned with the same pipeline and fixed settings.</p>

      <!-- 4 × 4 table -->
      <table>
        <thead>
          <tr>
            <th>Image</th>
            <th>Green Channel Displacement</th>
            <th>Red Channel Displacement</th>
            <th>Processing Time (s)</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><img src="Media/out_three_generations_pyr_simple.jpg" alt="Three_Generations — pyramid" loading="lazy"></td><td class="number">(53, 14)</td><td class="number">(112, 11)</td><td class="time">14.18</td></tr>
          
          <tr><td><img src="Media/out_three_generations_pyr_simple.jpg" alt="Three_Generations — pyramid" loading="lazy"></td><td class="number">(53, 14)</td><td class="number">(112, 11)</td><td class="time">14.18</td></tr>
          
          <tr><td><img src="Media/out_three_generations_pyr_simple.jpg" alt="Three_Generations — pyramid" loading="lazy"></td><td class="number">(53, 14)</td><td class="number">(112, 11)</td><td class="time">14.18</td></tr>
          
          <tr><td><img src="Media/out_three_generations_pyr_simple.jpg" alt="Three_Generations — pyramid" loading="lazy"></td><td class="number">(53, 14)</td><td class="number">(112, 11)</td><td class="time">14.18</td></tr>
        </tbody>
      </table>
    </section>
  </main>

  <footer>
    © <script>document.write(new Date().getFullYear());</script> Project 1. All images produced by the author.
  </footer>
</body>
</html>
